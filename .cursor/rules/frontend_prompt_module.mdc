# Promptæ¨¡å—å‰ç«¯å¼€å‘è§„åˆ™

## è§„åˆ™ç›®çš„

æœ¬è§„åˆ™æ–‡ä»¶å®šä¹‰äº†SparkCanvaså‰ç«¯Promptæ¨¡å—çš„å¼€å‘è§„èŒƒï¼Œç¡®ä¿ä»£ç è´¨é‡ã€UIä¸€è‡´æ€§å’Œç”¨æˆ·ä½“éªŒã€‚

## é€‚ç”¨èŒƒå›´

- `spark-uniapp/pages/prompt/prompt.vue` - Promptç®¡ç†é¡µé¢
- Promptæ¨¡å—ç›¸å…³çš„æ‰€æœ‰å‰ç«¯ä»£ç 
- UIç»„ä»¶å’Œäº¤äº’è®¾è®¡

## æŠ€æœ¯æ ˆè§„èŒƒ

### 1. Vue3 Composition API

**å¿…é¡»ä½¿ç”¨Composition APIï¼š**

```javascript
<script setup>
import { ref, reactive, computed, onLoad } from 'vue'
import http from '@/utils/http.js'
import storage from '@/utils/storage.js'

// å“åº”å¼æ•°æ®
const loading = ref(false)
const promptList = ref([])
const formData = reactive({
  name: '',
  content: '',
  platform: 'é€šç”¨'
})
</script>
```

**ç¦æ­¢ä½¿ç”¨Options APIï¼š**
- âŒ ä¸ä½¿ç”¨`export default { data(), methods: {} }`
- âœ… ä½¿ç”¨`<script setup>`

### 2. uni-appè§„èŒƒ

**é¡µé¢ç”Ÿå‘½å‘¨æœŸï¼š**
```javascript
import { onLoad, onShow, onPullDownRefresh } from '@dcloudio/uni-app'

onLoad(() => {
  // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
  loadPromptList()
})

onShow(() => {
  // é¡µé¢æ˜¾ç¤ºæ—¶æ‰§è¡Œ
  refreshData()
})
```

**è·¯ç”±è·³è½¬ï¼š**
```javascript
// è·³è½¬åˆ°TabBaré¡µé¢
uni.switchTab({ url: '/pages/workspace/workspace' })

// æ™®é€šé¡µé¢è·³è½¬
uni.navigateTo({ url: '/pages/detail/detail' })

// è¿”å›ä¸Šä¸€é¡µ
uni.navigateBack()
```

**æç¤ºæ¶ˆæ¯ï¼š**
```javascript
// æˆåŠŸæç¤º
uni.showToast({ title: 'æ“ä½œæˆåŠŸ', icon: 'success' })

// é”™è¯¯æç¤º
uni.showToast({ title: 'æ“ä½œå¤±è´¥', icon: 'none', duration: 2000 })

// åŠ è½½æç¤º
uni.showLoading({ title: 'åŠ è½½ä¸­...' })
uni.hideLoading()
```

## HTTPè¯·æ±‚è§„èŒƒ

### 1. ä½¿ç”¨å°è£…çš„httpå·¥å…·

**å¿…é¡»ä½¿ç”¨`utils/http.js`ä¸­çš„æ–¹æ³•ï¼š**

```javascript
import http from '@/utils/http.js'

// åˆ›å»ºPrompt
const createPrompt = async (data) => {
  try {
    const result = await http.createPrompt(data)
    // resultå·²ç»æ˜¯è§£æåçš„dataå­—æ®µ
    return result
  } catch (e) {
    console.error('åˆ›å»ºå¤±è´¥:', e)
    uni.showToast({ title: e.message || 'åˆ›å»ºå¤±è´¥', icon: 'none' })
    throw e
  }
}
```

**APIæ–¹æ³•æ˜ å°„ï¼š**
- `http.createPrompt(data)` â†’ `POST /api/v1/prompt/create`
- `http.getPrompts(params)` â†’ `GET /api/v1/prompt/list`
- `http.updatePrompt(data)` â†’ `PUT /api/v1/prompt/update`
- `http.deletePrompt(data)` â†’ `DELETE /api/v1/prompt/delete`

### 2. è¯·æ±‚å‚æ•°æ ¼å¼

**GETè¯·æ±‚ï¼ˆæŸ¥è¯¢å‚æ•°ï¼‰ï¼š**
```javascript
// http.jsä¸­å·²å¤„ç†ï¼Œç›´æ¥ä¼ å¯¹è±¡
const params = {
  page: 1,
  page_size: 20,
  platform: 'douyin',
  category: 'ç”Ÿæ´»vlog'
}
const result = await http.getPrompts(params)
```

**POST/PUT/DELETEè¯·æ±‚ï¼ˆè¯·æ±‚ä½“ï¼‰ï¼š**
```javascript
const data = {
  name: 'æ¨¡æ¿åç§°',
  content: 'Promptå†…å®¹',
  platform: 'xiaohongshu',
  category: 'å®¶å±…æ”¶çº³',
  description: 'æ¨¡æ¿æè¿°'
}
const result = await http.createPrompt(data)
```

### 3. å“åº”æ•°æ®å¤„ç†

**åç«¯å“åº”æ ¼å¼ï¼š**
```json
{
  "code": 200,
  "message": "success",
  "data": { ... }
}
```

**http.jså·²è‡ªåŠ¨å¤„ç†ï¼Œç›´æ¥ä½¿ç”¨dataï¼š**
```javascript
const result = await http.getPrompts(params)
// result å·²ç»æ˜¯ data å­—æ®µçš„å†…å®¹
const prompts = result.items || []
const total = result.total || 0
```

### 4. é”™è¯¯å¤„ç†

**ç»Ÿä¸€é”™è¯¯å¤„ç†ï¼š**
```javascript
try {
  const result = await http.createPrompt(data)
  uni.showToast({ title: 'åˆ›å»ºæˆåŠŸ', icon: 'success' })
  // å¤„ç†æˆåŠŸé€»è¾‘
} catch (e) {
  // http.jså·²å¤„ç†401ï¼Œè‡ªåŠ¨è·³è½¬ç™»å½•
  // å…¶ä»–é”™è¯¯æ˜¾ç¤ºæç¤º
  console.error('æ“ä½œå¤±è´¥:', e)
  uni.showToast({ 
    title: e.message || 'æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 
    icon: 'none',
    duration: 2000
  })
}
```

## UIè®¾è®¡è§„èŒƒ

### 1. é¡µé¢å¸ƒå±€

**é¡µé¢ç»“æ„ï¼š**
```vue
<template>
  <view class="prompt-page">
    <!-- å¤´éƒ¨ -->
    <view class="header">
      <text class="title">ğŸ¨ Promptç®¡ç†</text>
    </view>
    
    <!-- å†…å®¹å¡ç‰‡ -->
    <view class="content-card card">
      <!-- å†…å®¹ -->
    </view>
  </view>
</template>
```

**é¡µé¢æ ·å¼ï¼š**
```css
.prompt-page {
  min-height: 100vh;
  padding: 20rpx;
  background: #f8f8f8; /* æˆ–æ¸å˜èƒŒæ™¯ */
}
```

### 2. å¡ç‰‡å¼è®¾è®¡

**å¡ç‰‡æ ·å¼ï¼š**
```css
.card {
  background: #ffffff;
  border-radius: 24rpx;
  box-shadow: 0 4rpx 20rpx rgba(0, 0, 0, 0.08);
  padding: 40rpx 32rpx;
  margin-bottom: 24rpx;
}
```

### 3. æŒ‰é’®æ ·å¼

**ä¸»è¦æŒ‰é’®ï¼š**
```css
.btn-primary {
  background: linear-gradient(135deg, #3c9cff 0%, #4facfe 100%);
  color: #fff;
  border-radius: 999rpx;
  padding: 0 32rpx;
  height: 72rpx;
  line-height: 72rpx;
  font-size: 28rpx;
}
```

**æ¬¡è¦æŒ‰é’®ï¼š**
```css
.btn-secondary {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  color: #fff;
}
```

**è½®å»“æŒ‰é’®ï¼š**
```css
.btn-outline {
  background: transparent;
  border: 2rpx solid #3c9cff;
  color: #3c9cff;
}
```

### 4. è¾“å…¥æ¡†æ ·å¼

**è¾“å…¥æ¡†ï¼š**
```css
.input {
  width: 100%;
  height: 88rpx;
  padding: 0 28rpx;
  border-radius: 16rpx;
  background: #f8f8f8;
  border: 2rpx solid #e0e0e0;
  font-size: 30rpx;
  color: #333;
  box-sizing: border-box;
}

.input:focus {
  border-color: #3c9cff;
  background: #f0f7ff;
}
```

**æ–‡æœ¬åŸŸï¼š**
```css
.textarea {
  width: 100%;
  min-height: 200rpx;
  padding: 20rpx;
  border-radius: 16rpx;
  border: 2rpx solid #e5e5e5;
  background: #fafafa;
  font-size: 28rpx;
}
```

### 5. æ ‡ç­¾æ ·å¼

**æ ‡ç­¾é€‰æ‹©ï¼š**
```css
.tag {
  padding: 10rpx 24rpx;
  border-radius: 999rpx;
  font-size: 24rpx;
}

.tag-primary {
  background: linear-gradient(135deg, #3c9cff 0%, #4facfe 100%);
  color: #fff;
}

.tag-default {
  background-color: #f5f5f5;
  color: #666;
}
```

### 6. å•ä½è§„èŒƒ

**ä½¿ç”¨rpxå•ä½ï¼š**
- æ‰€æœ‰å°ºå¯¸ä½¿ç”¨`rpx`ï¼ˆå“åº”å¼åƒç´ ï¼‰
- 1rpx = å±å¹•å®½åº¦/750
- å­—ä½“å¤§å°ï¼š24rpx, 26rpx, 28rpx, 30rpx, 32rpx, 34rpx, 44rpx, 48rpx
- é—´è·ï¼š16rpx, 20rpx, 24rpx, 32rpx, 40rpx

## çŠ¶æ€ç®¡ç†è§„èŒƒ

### 1. å“åº”å¼æ•°æ®

**ä½¿ç”¨refå’Œreactiveï¼š**
```javascript
// ç®€å•å€¼ä½¿ç”¨ref
const loading = ref(false)
const page = ref(1)
const total = ref(0)

// å¯¹è±¡ä½¿ç”¨reactive
const formData = reactive({
  name: '',
  content: '',
  platform: 'é€šç”¨'
})

// æ•°ç»„ä½¿ç”¨ref
const promptList = ref([])
```

### 2. è®¡ç®—å±æ€§

**ä½¿ç”¨computedï¼š**
```javascript
import { computed } from 'vue'

const filteredList = computed(() => {
  return promptList.value.filter(item => {
    if (selectedPlatform.value && item.platform !== selectedPlatform.value) {
      return false
    }
    return true
  })
})
```

### 3. åŠ è½½çŠ¶æ€

**ç»Ÿä¸€ç®¡ç†åŠ è½½çŠ¶æ€ï¼š**
```javascript
const loading = ref(false)
const creating = ref(false)
const updating = ref(false)
const deleting = ref(false)

// åœ¨æŒ‰é’®ä¸Šä½¿ç”¨
<button :loading="creating" :disabled="creating" @click="handleCreate">
  {{ creating ? 'åˆ›å»ºä¸­...' : 'åˆ›å»º' }}
</button>
```

## è¡¨å•éªŒè¯è§„èŒƒ

### 1. å‰ç«¯éªŒè¯

**å¿…å¡«å­—æ®µéªŒè¯ï¼š**
```javascript
const validateForm = () => {
  if (!formData.name.trim()) {
    uni.showToast({ title: 'è¯·è¾“å…¥æ¨¡æ¿åç§°', icon: 'none' })
    return false
  }
  
  if (!formData.content.trim()) {
    uni.showToast({ title: 'è¯·è¾“å…¥Promptå†…å®¹', icon: 'none' })
    return false
  }
  
  // é•¿åº¦éªŒè¯
  if (formData.name.length > 255) {
    uni.showToast({ title: 'æ¨¡æ¿åç§°ä¸èƒ½è¶…è¿‡255ä¸ªå­—ç¬¦', icon: 'none' })
    return false
  }
  
  return true
}
```

### 2. å¹³å°å€¼éªŒè¯

**ä½¿ç”¨Literalç±»å‹é™åˆ¶ï¼š**
```javascript
const platforms = [
  { label: 'å°çº¢ä¹¦', value: 'xiaohongshu' },
  { label: 'æŠ–éŸ³', value: 'douyin' },
  { label: 'é€šç”¨', value: 'é€šç”¨' }
]

const validatePlatform = (platform) => {
  const validPlatforms = ['xiaohongshu', 'douyin', 'é€šç”¨']
  return validPlatforms.includes(platform)
}
```

## åˆ—è¡¨å±•ç¤ºè§„èŒƒ

### 1. åˆ†é¡µåˆ—è¡¨

**åˆ†é¡µå‚æ•°ï¼š**
```javascript
const page = ref(1)
const pageSize = ref(20)
const total = ref(0)

const loadPromptList = async () => {
  try {
    loading.value = true
    const params = {
      page: page.value,
      page_size: pageSize.value,
      platform: selectedPlatform.value || undefined,
      category: selectedCategory.value || undefined
    }
    const result = await http.getPrompts(params)
    promptList.value = result.items || []
    total.value = result.total || 0
  } catch (e) {
    console.error('åŠ è½½åˆ—è¡¨å¤±è´¥:', e)
  } finally {
    loading.value = false
  }
}
```

### 2. ä¸‹æ‹‰åˆ·æ–°

**å®ç°ä¸‹æ‹‰åˆ·æ–°ï¼š**
```javascript
import { onPullDownRefresh } from '@dcloudio/uni-app'

onPullDownRefresh(async () => {
  page.value = 1
  await loadPromptList()
  uni.stopPullDownRefresh()
})
```

**åœ¨pages.jsonä¸­å¯ç”¨ï¼š**
```json
{
  "path": "pages/prompt/prompt",
  "style": {
    "enablePullDownRefresh": true
  }
}
```

### 3. ä¸Šæ‹‰åŠ è½½æ›´å¤š

**å®ç°ä¸Šæ‹‰åŠ è½½ï¼š**
```javascript
const loadMore = async () => {
  if (promptList.value.length >= total.value) {
    uni.showToast({ title: 'æ²¡æœ‰æ›´å¤šæ•°æ®äº†', icon: 'none' })
    return
  }
  
  page.value++
  await loadPromptList()
}
```

## äº¤äº’è®¾è®¡è§„èŒƒ

### 1. æ“ä½œåé¦ˆ

**æˆåŠŸæ“ä½œï¼š**
```javascript
uni.showToast({ 
  title: 'åˆ›å»ºæˆåŠŸ', 
  icon: 'success',
  duration: 1500
})

// å»¶è¿Ÿè·³è½¬æˆ–åˆ·æ–°
setTimeout(() => {
  loadPromptList()
}, 1500)
```

**é”™è¯¯æ“ä½œï¼š**
```javascript
uni.showToast({ 
  title: errorMessage, 
  icon: 'none',
  duration: 2000
})
```

### 2. ç¡®è®¤å¯¹è¯æ¡†

**åˆ é™¤ç¡®è®¤ï¼š**
```javascript
const handleDelete = (id) => {
  uni.showModal({
    title: 'ç¡®è®¤åˆ é™¤',
    content: 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªPromptæ¨¡æ¿å—ï¼Ÿ',
    success: async (res) => {
      if (res.confirm) {
        await deletePrompt(id)
      }
    }
  })
}
```

### 3. åŠ è½½çŠ¶æ€

**æŒ‰é’®åŠ è½½çŠ¶æ€ï¼š**
```vue
<button 
  :loading="loading" 
  :disabled="loading || !formData.name.trim()"
  @click="handleSubmit"
>
  {{ loading ? 'æäº¤ä¸­...' : 'æäº¤' }}
</button>
```

## ä»£ç ç»„ç»‡è§„èŒƒ

### 1. ä»£ç ç»“æ„

**Vueç»„ä»¶ç»“æ„ï¼š**
```vue
<template>
  <!-- æ¨¡æ¿ -->
</template>

<script setup>
// 1. å¯¼å…¥
import { ref, reactive, computed, onLoad } from 'vue'
import http from '@/utils/http.js'

// 2. å“åº”å¼æ•°æ®
const loading = ref(false)

// 3. è®¡ç®—å±æ€§
const filteredList = computed(() => { ... })

// 4. æ–¹æ³•
const handleCreate = async () => { ... }

// 5. ç”Ÿå‘½å‘¨æœŸ
onLoad(() => { ... })
</script>

<style scoped>
/* æ ·å¼ */
</style>
```

### 2. æ–¹æ³•å‘½å

**å‘½åè§„èŒƒï¼š**
- äº‹ä»¶å¤„ç†ï¼š`handleXxx`ï¼ˆå¦‚`handleCreate`, `handleDelete`ï¼‰
- æ•°æ®åŠ è½½ï¼š`loadXxx`ï¼ˆå¦‚`loadPromptList`ï¼‰
- æ•°æ®åˆ·æ–°ï¼š`refreshXxx`ï¼ˆå¦‚`refreshData`ï¼‰
- éªŒè¯ï¼š`validateXxx`ï¼ˆå¦‚`validateForm`ï¼‰
- æ ¼å¼åŒ–ï¼š`formatXxx`ï¼ˆå¦‚`formatTime`ï¼‰

### 3. æ³¨é‡Šè§„èŒƒ

**æ·»åŠ å¿…è¦æ³¨é‡Šï¼š**
```javascript
// ========== å“åº”å¼æ•°æ® ==========
const loading = ref(false)

// ========== æ–¹æ³• ==========
/**
 * åˆ›å»ºPrompt
 */
const handleCreate = async () => {
  // éªŒè¯è¡¨å•
  if (!validateForm()) return
  
  // è°ƒç”¨API
  try {
    await http.createPrompt(formData)
    // æˆåŠŸå¤„ç†
  } catch (e) {
    // é”™è¯¯å¤„ç†
  }
}
```

## æœ€ä½³å®è·µ

### 1. æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨`v-if`å’Œ`v-show`åˆç†æ§åˆ¶æ¸²æŸ“
- é•¿åˆ—è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¦‚éœ€è¦ï¼‰
- å›¾ç‰‡ä½¿ç”¨æ‡’åŠ è½½
- é¿å…åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨å¤æ‚è®¡ç®—ï¼Œä½¿ç”¨computed

### 2. ç”¨æˆ·ä½“éªŒ

- æ“ä½œå‰ç»™å‡ºæ˜ç¡®æç¤º
- åŠ è½½çŠ¶æ€æ¸…æ™°å¯è§
- é”™è¯¯ä¿¡æ¯å‹å¥½æ˜“æ‡‚
- æ“ä½œæˆåŠŸååŠæ—¶åé¦ˆ

### 3. ä»£ç å¤ç”¨

- å…¬å…±é€»è¾‘æå–ä¸ºå·¥å…·å‡½æ•°
- å…¬å…±ç»„ä»¶æå–ä¸ºç‹¬ç«‹ç»„ä»¶
- æ ·å¼ä½¿ç”¨å…¬å…±ç±»å

### 4. é”™è¯¯å¤„ç†

- æ‰€æœ‰APIè°ƒç”¨ä½¿ç”¨try-catch
- ç½‘ç»œé”™è¯¯å‹å¥½æç¤º
- 401é”™è¯¯è‡ªåŠ¨è·³è½¬ç™»å½•ï¼ˆhttp.jså·²å¤„ç†ï¼‰
- å…¶ä»–é”™è¯¯æ˜¾ç¤ºå…·ä½“ä¿¡æ¯

## å¸¸è§é—®é¢˜é¿å…

1. âŒ **å¿˜è®°å¤„ç†åŠ è½½çŠ¶æ€**ï¼šæ‰€æœ‰å¼‚æ­¥æ“ä½œéƒ½è¦ç®¡ç†loading
2. âŒ **ç¼ºå°‘è¡¨å•éªŒè¯**ï¼šæäº¤å‰å¿…é¡»éªŒè¯
3. âŒ **é”™è¯¯å¤„ç†ä¸å®Œå–„**ï¼šæ‰€æœ‰APIè°ƒç”¨éƒ½è¦catché”™è¯¯
4. âŒ **å•ä½ä½¿ç”¨é”™è¯¯**ï¼šä½¿ç”¨pxè€Œä¸æ˜¯rpx
5. âŒ **ç›´æ¥æ“ä½œDOM**ï¼šä½¿ç”¨Vueå“åº”å¼æ•°æ®
6. âŒ **ç¡¬ç¼–ç APIåœ°å€**ï¼šä½¿ç”¨config.jsä¸­çš„BASE_URL
