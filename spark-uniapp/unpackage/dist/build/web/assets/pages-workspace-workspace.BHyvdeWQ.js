import{i as a,a as l,g as e,O as s,r as t,c as u,b as n,w as i,s as o,d,o as c,e as v,f as r,t as _,h as f,j as m,k as g,F as y,l as b,m as p,n as h,p as k,q as w,u as x}from"./index-DiFUrjbL.js";import{_ as C,h as S}from"./_plugin-vue_export-helper.BWtSqQHM.js";const j=((s,t=0)=>(t,u=e())=>{!a&&l(s,t,u)})(s,2),$=C({__name:"workspace",setup(a){const l=[{label:"小红书",value:"xiaohongshu"},{label:"抖音",value:"douyin"}],e=[{label:"联网检索",value:"online"},{label:"RAG知识库",value:"rag"}],s=t(""),C=t({}),$=t("xiaohongshu"),M=t("online"),V=t(""),D=t(!1),F=t(!1),q=t(!1),A=t(""),G=t(""),H=t(""),I=t(""),O=t(""),R=u((()=>G.value?G.value.split("\n"):[])),U=a=>{if(!a)return"";const l=new Date(a);return`${l.getMonth()+1}/${l.getDate()} ${l.getHours()}:${String(l.getMinutes()).padStart(2,"0")}`},z=async()=>{var a,l,e;try{D.value=!0;const t=await S.createSession();s.value=(null==(a=null==t?void 0:t.data)?void 0:a.session_id)||"",s.value&&(C.value={created_at:null==(l=null==t?void 0:t.data)?void 0:l.created_at,expires_at:null==(e=null==t?void 0:t.data)?void 0:e.expires_at,message_count:0})}catch(t){console.error("创建工作台会话失败:",t),o({title:(null==t?void 0:t.message)||"创建会话失败",icon:"none"})}finally{D.value=!1}},B=async()=>{q.value=!1,A.value="",G.value="",H.value="",V.value="",await z(),o({title:"已创建新会话",icon:"success"})},E=async()=>{if(s.value)try{const a=await S.getSession(s.value);(null==a?void 0:a.data)&&(C.value=a.data)}catch(a){console.error("获取会话信息失败:",a),o({title:(null==a?void 0:a.message)||"获取会话信息失败",icon:"none"})}},J=async()=>{var a,l,e;if(V.value.trim()&&(s.value||(await z(),s.value)))try{D.value=!0;const t={session_id:s.value,message:V.value,material_source:M.value,platform:$.value},u=await S.sendMessage(t),n=null==(a=null==u?void 0:u.data)?void 0:a.content;n?(A.value=n.title||"",G.value=n.body||"",H.value=n.image_url||"",I.value=(null==(l=null==u?void 0:u.data)?void 0:l.status)||"completed",O.value=U(null==(e=null==u?void 0:u.data)?void 0:e.timestamp),q.value=!0,await E()):o({title:"后端未返回内容",icon:"none"})}catch(t){console.error("发送消息失败:",t),o({title:(null==t?void 0:t.message)||"生成失败，请稍后重试",icon:"none"})}finally{D.value=!1}},K=async()=>{var a,l,e;if(s.value)try{F.value=!0;const t={session_id:s.value,adjustments:{emotion_intensity:"high",style_preference:"xiaohongshu"===$.value?"小红书爆款":"抖音热门"}},u=await S.regenerate(t),n=null==(a=null==u?void 0:u.data)?void 0:a.content;n&&(A.value=n.title||"",G.value=n.body||"",H.value=n.image_url||"",I.value=(null==(l=null==u?void 0:u.data)?void 0:l.status)||"completed",O.value=U(null==(e=null==u?void 0:u.data)?void 0:e.timestamp),await E(),o({title:"重新生成完成",icon:"success"}))}catch(t){console.error("重新生成失败:",t),o({title:(null==t?void 0:t.message)||"重新生成失败",icon:"none"})}finally{F.value=!1}},L=()=>{let a="";A.value&&(a+=A.value+"\n\n"),G.value&&(a+=G.value),a.trim()?b({data:a,success:()=>{o({title:"复制成功",icon:"success",duration:1500})},fail:a=>{console.error("复制失败:",a),o({title:"复制失败，请稍后重试",icon:"none"})}}):o({title:"内容为空，无法复制",icon:"none"})};return j((async()=>{await z()})),(a,t)=>{const u=p,o=d,b=h,S=k,j=w;return c(),n(o,{class:"workspace-page"},{default:i((()=>[v(o,{class:"header"},{default:i((()=>[v(u,{class:"title"},{default:i((()=>[r("✨ SparkCanvas 工作台")])),_:1}),v(u,{class:"subtitle"},{default:i((()=>[r("一键生成爆款内容")])),_:1})])),_:1}),s.value?(c(),n(o,{key:0,class:"session-card card"},{default:i((()=>[v(o,{class:"session-header"},{default:i((()=>[v(u,{class:"session-label"},{default:i((()=>[r("当前会话")])),_:1}),v(u,{class:"session-id"},{default:i((()=>[r(_(s.value.slice(0,8))+"...",1)])),_:1})])),_:1}),v(o,{class:"session-meta"},{default:i((()=>[v(u,null,{default:i((()=>[r("消息数: "+_(C.value.message_count||0),1)])),_:1}),C.value.last_message_time?(c(),n(u,{key:0},{default:i((()=>[r("最后消息: "+_(U(C.value.last_message_time)),1)])),_:1})):f("",!0)])),_:1}),v(o,{class:"session-actions"},{default:i((()=>[v(b,{class:"btn btn-small btn-outline",onClick:E},{default:i((()=>[r("刷新状态")])),_:1}),v(b,{class:"btn btn-small btn-outline",onClick:B},{default:i((()=>[r("新建会话")])),_:1})])),_:1})])),_:1})):f("",!0),v(o,{class:"content-card card"},{default:i((()=>[v(o,{class:"card-title"},{default:i((()=>[r("📝 内容创作")])),_:1}),v(o,{class:"field-row"},{default:i((()=>[v(o,{class:"field-label"},{default:i((()=>[r("目标平台")])),_:1}),v(o,{class:"field-value tags-row"},{default:i((()=>[(c(),m(y,null,g(l,(a=>v(u,{key:a.value,class:x(["tag",$.value===a.value?"tag-primary":"tag-default"]),onClick:l=>$.value=a.value},{default:i((()=>[r(_(a.label),1)])),_:2},1032,["class","onClick"]))),64))])),_:1})])),_:1}),v(o,{class:"field-row"},{default:i((()=>[v(o,{class:"field-label"},{default:i((()=>[r("素材来源")])),_:1}),v(o,{class:"field-value tags-row"},{default:i((()=>[(c(),m(y,null,g(e,(a=>v(u,{key:a.value,class:x(["tag",M.value===a.value?"tag-primary":"tag-default"]),onClick:l=>M.value=a.value},{default:i((()=>[r(_(a.label),1)])),_:2},1032,["class","onClick"]))),64))])),_:1})])),_:1}),v(o,{class:"field-row column"},{default:i((()=>[v(o,{class:"field-label"},{default:i((()=>[r("创作需求")])),_:1}),v(S,{class:"input-area",modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=a=>V.value=a),placeholder:"例如：帮我写一篇关于提升小红书笔记爆款率的心得分享","auto-height":!0,maxlength:"-1"},null,8,["modelValue"])])),_:1}),v(o,{class:"actions-row"},{default:i((()=>[q.value?(c(),n(b,{key:0,class:"btn btn-secondary",loading:F.value,disabled:F.value,onClick:K},{default:i((()=>[r(_(F.value?"重新生成中...":"🔄 重新生成"),1)])),_:1},8,["loading","disabled"])):f("",!0),v(b,{class:"btn btn-primary",disabled:D.value||!V.value.trim(),onClick:J},{default:i((()=>[r(" 生成内容 ")])),_:1},8,["disabled"])])),_:1}),q.value?(c(),n(o,{key:0,class:"result-card"},{default:i((()=>[v(o,{class:"result-header"},{default:i((()=>[v(u,{class:"result-label"},{default:i((()=>[r("生成结果")])),_:1}),v(o,{class:"result-actions"},{default:i((()=>["completed"===I.value?(c(),n(u,{key:0,class:"result-status"},{default:i((()=>[r("生成完毕")])),_:1})):f("",!0),"completed"===I.value?(c(),n(b,{key:1,class:"btn-copy",onClick:L},{default:i((()=>[r(" 复制 ")])),_:1})):f("",!0)])),_:1})])),_:1}),v(o,{class:"result-title"},{default:i((()=>[r(_(A.value),1)])),_:1}),v(o,{class:"result-body"},{default:i((()=>[(c(!0),m(y,null,g(R.value,((a,l)=>(c(),n(u,{key:l},{default:i((()=>[r(_(a)+_(l<R.value.length-1?"\n":""),1)])),_:2},1024)))),128))])),_:1}),H.value?(c(),n(o,{key:0,class:"result-image"},{default:i((()=>[v(j,{src:H.value,mode:"widthFix"},null,8,["src"])])),_:1})):f("",!0),v(o,{class:"result-meta"},{default:i((()=>[v(u,null,{default:i((()=>[r("生成时间: "+_(O.value),1)])),_:1})])),_:1})])),_:1})):(c(),n(o,{key:1,class:"placeholder"},{default:i((()=>[v(u,null,{default:i((()=>[r("选择平台和素材来源，输入创作需求，点击生成按钮开始创作。")])),_:1})])),_:1}))])),_:1})])),_:1})}}},[["__scopeId","data-v-bb896265"]]);export{$ as default};
