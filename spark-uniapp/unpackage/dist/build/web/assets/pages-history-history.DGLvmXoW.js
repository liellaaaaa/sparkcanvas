import{r as e,E as a,b as s,w as l,s as t,d as n,o as i,e as u,f as o,t as c,h as d,j as r,k as f,F as _,m as v,I as m,n as p,u as h,l as g,A as y}from"./index-DiFUrjbL.js";import{_ as b,h as k}from"./_plugin-vue_export-helper.BWtSqQHM.js";const C=b({__name:"history",setup(b){const C=e([]),x=e(!1),w=e(1),$=e(20),j=e(0),M=e(""),z=e(!1),D=e({}),V=e(0),H=e=>{if(!e)return"";const a=new Date(e),s=new Date-a;return s<6e4?"åˆšåˆš":s<36e5?`${Math.floor(s/6e4)}åˆ†é’Ÿå‰`:s<864e5?`${Math.floor(s/36e5)}å°æ—¶å‰`:s<6048e5?`${Math.floor(s/864e5)}å¤©å‰`:a.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},I=async(e=!1)=>{e&&(w.value=1),x.value=!0;try{let e;e=z.value&&M.value.trim()?await k.searchHistory({keyword:M.value.trim(),page:w.value,page_size:$.value}):await k.getConversations({page:w.value,page_size:$.value}),200===e.code?(C.value=e.data.items||[],j.value=e.data.total||0,V.value=Math.ceil(j.value/$.value),D.value={}):t({title:e.message||"åŠ è½½å¤±è´¥",icon:"none"})}catch(a){console.error("åŠ è½½åŽ†å²è®°å½•å¤±è´¥:",a),t({title:a.message||"åŠ è½½å¤±è´¥",icon:"none"})}finally{x.value=!1}},A=()=>{M.value.trim()?(z.value=!0,I(!0)):t({title:"è¯·è¾“å…¥æœç´¢å…³é”®è¯",icon:"none"})},E=()=>{z.value=!1,M.value="",I(!0)},F=e=>{e<1||e>V.value||(w.value=e,I())},L=e=>{if(!e)return"";const a=e.split("\n");return a.length<=5?e:a.slice(0,5).join("\n")},N=e=>{if(!e)return!1;return e.split("\n").length>5},S=e=>`${e.session_id}-${e.timestamp}`,U=e=>D.value[S(e)]||!1;return a((()=>{I()})),(e,a)=>{const b=v,$=n,q=m,B=p;return i(),s($,{class:"history-page"},{default:l((()=>[u($,{class:"header"},{default:l((()=>[u(b,{class:"title"},{default:l((()=>[o("ðŸ“š åŽ†å²è®°å½•")])),_:1})])),_:1}),u($,{class:"search-card card"},{default:l((()=>[u($,{class:"search-box"},{default:l((()=>[u(q,{class:"search-input",modelValue:M.value,"onUpdate:modelValue":a[0]||(a[0]=e=>M.value=e),placeholder:"æœç´¢åŽ†å²è®°å½•...",onConfirm:A},null,8,["modelValue"]),u(B,{class:"btn btn-primary btn-small",onClick:A},{default:l((()=>[o("ðŸ” æœç´¢")])),_:1})])),_:1}),z.value?(i(),s($,{key:0,class:"search-tip"},{default:l((()=>[u(b,null,{default:l((()=>[o("æœç´¢å…³é”®è¯: "+c(M.value),1)])),_:1}),u(b,{class:"cancel-search",onClick:E},{default:l((()=>[o("å–æ¶ˆæœç´¢")])),_:1})])),_:1})):d("",!0)])),_:1}),u($,{class:"history-list"},{default:l((()=>[x.value?(i(),s($,{key:0,class:"loading"},{default:l((()=>[u(b,null,{default:l((()=>[o("åŠ è½½ä¸­...")])),_:1})])),_:1})):0===C.value.length?(i(),s($,{key:1,class:"empty"},{default:l((()=>[u(b,null,{default:l((()=>[o("æš‚æ— åŽ†å²è®°å½•")])),_:1})])),_:1})):(i(),s($,{key:2},{default:l((()=>[(i(!0),r(_,null,f(C.value,((e,a)=>(i(),s($,{key:`${e.session_id}-${e.timestamp}`,class:"history-item card"},{default:l((()=>[u($,{class:"item-header"},{default:l((()=>[u(b,{class:"session-tag"},{default:l((()=>[o("ä¼šè¯: "+c(e.session_id.slice(0,8))+"...",1)])),_:2},1024),u($,{class:"header-right"},{default:l((()=>[u(b,{class:"time-text"},{default:l((()=>[o(c(H(e.timestamp)),1)])),_:2},1024),u(B,{class:"btn-delete",onClick:a=>(e=>{y({title:"ç¡®è®¤åˆ é™¤",content:"ç¡®å®šè¦åˆ é™¤è¿™æ¡åŽ†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚",success:async a=>{if(a.confirm)try{await k.deleteHistory({session_id:e.session_id,timestamp:e.timestamp}),t({title:"åˆ é™¤æˆåŠŸ",icon:"success"}),await I()}catch(s){console.error("åˆ é™¤å¤±è´¥:",s),t({title:s.message||"åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•",icon:"none",duration:2e3})}}})})(e)},{default:l((()=>[o("ðŸ—‘ï¸ åˆ é™¤")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024),u($,{class:"item-content"},{default:l((()=>[u($,{class:"message-section"},{default:l((()=>[u(b,{class:"label"},{default:l((()=>[o("ç”¨æˆ·æ¶ˆæ¯ï¼š")])),_:1}),u(b,{class:"message-text"},{default:l((()=>[o(c(e.message),1)])),_:2},1024)])),_:2},1024),u($,{class:"response-section"},{default:l((()=>[u(b,{class:"label"},{default:l((()=>[o("åŠ©æ‰‹å›žå¤ï¼š")])),_:1}),u($,{class:"response-container"},{default:l((()=>[u(b,{class:h(["response-text",{expanded:U(e)}])},{default:l((()=>[o(c(U(e)?e.response:L(e.response)),1)])),_:2},1032,["class"]),u($,{class:"action-buttons"},{default:l((()=>[u(b,{class:"action-btn copy-btn",onClick:a=>(e=>{const a=e.response||"";a?g({data:a,success:()=>{t({title:"å¤åˆ¶æˆåŠŸ",icon:"success",duration:1500})},fail:e=>{console.error("å¤åˆ¶å¤±è´¥:",e),t({title:"å¤åˆ¶å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•",icon:"none"})}}):t({title:"å†…å®¹ä¸ºç©ºï¼Œæ— æ³•å¤åˆ¶",icon:"none"})})(e)},{default:l((()=>[o(" å¤åˆ¶ ")])),_:2},1032,["onClick"]),N(e.response)?(i(),s(b,{key:0,class:"action-btn expand-btn",onClick:a=>(e=>{const a=S(e);D.value[a]=!D.value[a]})(e)},{default:l((()=>[o(c(U(e)?"æ”¶èµ·":"å±•å¼€"),1)])),_:2},1032,["onClick"])):d("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}))])),_:1}),j.value>0?(i(),s($,{key:0,class:"pagination"},{default:l((()=>[u(B,{class:"btn btn-outline btn-small",disabled:1===w.value,onClick:a[1]||(a[1]=e=>F(w.value-1))},{default:l((()=>[o("ä¸Šä¸€é¡µ")])),_:1},8,["disabled"]),u(b,{class:"page-info"},{default:l((()=>[o("ç¬¬ "+c(w.value)+" / "+c(V.value)+" é¡µ (å…± "+c(j.value)+" æ¡)",1)])),_:1}),u(B,{class:"btn btn-outline btn-small",disabled:w.value>=V.value,onClick:a[2]||(a[2]=e=>F(w.value+1))},{default:l((()=>[o("ä¸‹ä¸€é¡µ")])),_:1},8,["disabled"])])),_:1})):d("",!0)])),_:1})}}},[["__scopeId","data-v-075cd73c"]]);export{C as default};
