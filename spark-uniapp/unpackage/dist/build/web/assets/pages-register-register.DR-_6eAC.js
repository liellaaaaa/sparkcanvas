import{v as e,r as l,D as a,b as s,w as t,d as o,o as n,e as i,f as r,t as c,s as d,x as u,B as p,y as m,z as f,C as g,m as _,I as w,n as h}from"./index-DiFUrjbL.js";import{_ as v,h as y}from"./_plugin-vue_export-helper.BWtSqQHM.js";const V=v({__name:"register",setup(v){const V=e({username:"",email:"",verifyCode:"",password:"",confirmPassword:""}),b=l(!1),C=l(0);let k=null;const I=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),x=async()=>{if(V.email.trim())if(I(V.email)){if(!(C.value>0))try{u({title:"发送中..."}),await y.sendCode(V.email.trim()),d({title:"验证码已发送，请查收邮箱",icon:"success",duration:2e3}),C.value=60,k&&clearInterval(k),k=setInterval((()=>{C.value--,C.value<=0&&(clearInterval(k),k=null)}),1e3)}catch(e){console.error("发送验证码失败:",e),d({title:e.message||"验证码发送失败，请稍后重试",icon:"none",duration:2e3})}finally{p()}}else d({title:"请输入正确的邮箱格式",icon:"none"});else d({title:"请先输入邮箱",icon:"none"})},P=async()=>{if(V.username.trim())if(V.username.trim().length<3||V.username.trim().length>20)d({title:"用户名长度为3-20个字符",icon:"none"});else if(V.email.trim())if(I(V.email))if(V.verifyCode.trim())if(4===V.verifyCode.trim().length)if(V.password.trim())if(V.password.length<6||V.password.length>20)d({title:"密码长度为6-20个字符",icon:"none"});else if(V.confirmPassword.trim())if(V.password===V.confirmPassword){b.value=!0,u({title:"注册中..."});try{await y.register({username:V.username.trim(),email:V.email.trim(),password:V.password,confirm_password:V.confirmPassword,code:V.verifyCode.trim()}),d({title:"注册成功",icon:"success"}),setTimeout((async()=>{try{const e=await y.login({email:V.email.trim(),password:V.password});m.setToken(e.token),m.setUserInfo(e.user),f({url:"/pages/workspace/workspace"})}catch(e){console.error("自动登录失败:",e),d({title:"注册成功，请登录",icon:"success"}),setTimeout((()=>{g({url:"/pages/login/login"})}),1500)}}),1500)}catch(e){console.error("注册失败:",e),d({title:e.message||"注册失败，请检查信息后重试",icon:"none",duration:2e3})}finally{b.value=!1,p()}}else d({title:"两次输入的密码不一致",icon:"none"});else d({title:"请确认密码",icon:"none"});else d({title:"请输入密码",icon:"none"});else d({title:"验证码为4位数字",icon:"none"});else d({title:"请输入验证码",icon:"none"});else d({title:"请输入正确的邮箱格式",icon:"none"});else d({title:"请输入邮箱",icon:"none"});else d({title:"请输入用户名",icon:"none"})},U=()=>{g({url:"/pages/login/login"})};return a((()=>{k&&(clearInterval(k),k=null)})),(e,l)=>{const a=_,d=o,u=w,p=h;return n(),s(d,{class:"register-page"},{default:t((()=>[i(d,{class:"header"},{default:t((()=>[i(a,{class:"title"},{default:t((()=>[r("注册 SparkCanvas")])),_:1}),i(a,{class:"subtitle"},{default:t((()=>[r("开启AI创作之旅")])),_:1})])),_:1}),i(d,{class:"register-card card"},{default:t((()=>[i(d,{class:"input-group"},{default:t((()=>[i(a,{class:"label"},{default:t((()=>[r("用户名")])),_:1}),i(u,{modelValue:V.username,"onUpdate:modelValue":l[0]||(l[0]=e=>V.username=e),class:"input",placeholder:"请输入用户名","placeholder-class":"placeholder",type:"text"},null,8,["modelValue"])])),_:1}),i(d,{class:"input-group"},{default:t((()=>[i(a,{class:"label"},{default:t((()=>[r("邮箱")])),_:1}),i(u,{modelValue:V.email,"onUpdate:modelValue":l[1]||(l[1]=e=>V.email=e),class:"input",placeholder:"请输入邮箱","placeholder-class":"placeholder",type:"text"},null,8,["modelValue"])])),_:1}),i(d,{class:"input-group"},{default:t((()=>[i(a,{class:"label"},{default:t((()=>[r("验证码")])),_:1}),i(d,{class:"code-row"},{default:t((()=>[i(u,{modelValue:V.verifyCode,"onUpdate:modelValue":l[2]||(l[2]=e=>V.verifyCode=e),class:"input code-input",placeholder:"请输入验证码","placeholder-class":"placeholder",type:"text"},null,8,["modelValue"]),i(p,{class:"code-btn",onClick:x,disabled:C.value>0},{default:t((()=>[r(c(C.value>0?`${C.value}s`:"发送验证码"),1)])),_:1},8,["disabled"])])),_:1})])),_:1}),i(d,{class:"input-group"},{default:t((()=>[i(a,{class:"label"},{default:t((()=>[r("密码")])),_:1}),i(u,{modelValue:V.password,"onUpdate:modelValue":l[3]||(l[3]=e=>V.password=e),class:"input",placeholder:"请输入密码（6-20位）","placeholder-class":"placeholder",type:"password"},null,8,["modelValue"])])),_:1}),i(d,{class:"input-group"},{default:t((()=>[i(a,{class:"label"},{default:t((()=>[r("确认密码")])),_:1}),i(u,{modelValue:V.confirmPassword,"onUpdate:modelValue":l[4]||(l[4]=e=>V.confirmPassword=e),class:"input",placeholder:"请再次输入密码","placeholder-class":"placeholder",type:"password"},null,8,["modelValue"])])),_:1}),i(p,{class:"btn register-btn",onClick:P,loading:b.value},{default:t((()=>[r(c(b.value?"注册中...":"注册"),1)])),_:1},8,["loading"]),i(d,{class:"footer-links"},{default:t((()=>[i(a,{class:"link",onClick:U},{default:t((()=>[r("已有账号？立即登录")])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-cab3f8e4"]]);export{V as default};
