import{H as e,J as t,K as o,L as r,M as a}from"./index-DiFUrjbL.js";const n={BASE_URL:"http://47.83.142.3:8000",TIMEOUT:15e3,TOKEN_KEY:"access_token",USER_INFO_KEY:"user_info"};if("undefined"!=typeof window&&window.location){const e=window.location.hostname;if(n.BASE_URL.includes("localhost")&&"localhost"!==e&&"127.0.0.1"!==e){const t=window.location.protocol,o="8000";n.BASE_URL=`${t}//${e}:${o}`,console.log("自动检测到后端地址:",n.BASE_URL)}}const s=n.BASE_URL,i=o=>new Promise(((i,d)=>{const l=(e=>{const o=t(n.TOKEN_KEY);return o&&(e.header={...e.header,Authorization:`Bearer ${o}`}),e.header={"Content-Type":"application/json",...e.header},e})({url:s+o.url,method:o.method||"GET",data:o.data,header:o.header||{},timeout:o.timeout||n.TIMEOUT});if(["POST","PUT","DELETE","PATCH"].includes(l.method.toUpperCase())&&l.data&&"string"==typeof l.data)try{l.data=JSON.parse(l.data)}catch(c){}console.log("发送请求:",{url:l.url,method:l.method,data:l.data,header:l.header,timeout:l.timeout}),a({url:l.url,method:l.method,data:l.data,header:l.header,timeout:l.timeout,dataType:"json",success:t=>{console.log("请求成功:",{statusCode:t.statusCode,data:t.data}),(t=>{const{statusCode:o,data:a}=t;if(200===o){if(a&&"object"==typeof a){if("code"in a){if(200===a.code)return Promise.resolve(a);{const e=a.message||a.error||"请求失败";return Promise.reject(new Error(e))}}return Promise.resolve(a)}return Promise.resolve(a)}if(400===o){const e=(null==a?void 0:a.detail)||(null==a?void 0:a.message)||"请求参数错误";return Promise.reject(new Error(e))}return 401===o?(e(n.TOKEN_KEY),e(n.USER_INFO_KEY),r({url:"/pages/login/login"}),Promise.reject(new Error("登录已过期，请重新登录"))):403===o?Promise.reject(new Error((null==a?void 0:a.detail)||"无权限访问")):500===o?Promise.reject(new Error((null==a?void 0:a.detail)||"服务器错误")):Promise.reject(new Error((null==a?void 0:a.detail)||`请求失败: ${o}`))})(t).then(i).catch(d)},fail:e=>{console.error("请求失败:",e),console.error("请求配置:",{url:l.url,method:l.method,timeout:l.timeout});let t=e.errMsg||"网络请求失败";t.includes("timeout")?t=`请求超时（${l.timeout}ms），请检查：\n1. 后端服务是否已启动（访问 http://localhost:8000/health 测试）\n2. 后端服务是否正常运行\n3. 数据库连接是否正常\n4. 检查浏览器控制台是否有CORS错误`:(t.includes("fail")||t.includes("connect"))&&(t=`无法连接到服务器（${l.url}），请检查：\n1. 后端服务是否已启动\n2. 后端服务是否监听在正确的地址和端口\n3. 防火墙是否阻止了连接\n4. 检查浏览器控制台是否有CORS错误`),d(new Error(t))}})})),d={testConnection:()=>i({url:"/health",method:"GET",timeout:5e3}),sendCode:e=>i({url:`/auth/code?email=${encodeURIComponent(e)}`,method:"GET"}),register:e=>i({url:"/auth/register",method:"POST",data:e}),login:e=>i({url:"/auth/login",method:"POST",data:e,timeout:15e3}),logout:()=>(e(n.TOKEN_KEY),e(n.USER_INFO_KEY),Promise.resolve()),createSession:()=>i({url:"/api/v1/workspace/create-session",method:"POST",timeout:1e4}),sendMessage:e=>i({url:"/api/v1/workspace/send-message",method:"POST",data:e,timeout:12e4}),getSession:e=>i({url:`/api/v1/workspace/session/${e}`,method:"GET",timeout:1e4}),regenerate:e=>i({url:"/api/v1/workspace/regenerate",method:"POST",data:e,timeout:12e4}),getConversations:e=>{const t=Object.keys(e||{}).filter((t=>void 0!==e[t]&&null!==e[t])).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&");return i({url:"/api/v1/history/conversations"+(t?"?"+t:""),method:"GET"})},searchHistory:e=>{const t=Object.keys(e||{}).filter((t=>void 0!==e[t]&&null!==e[t])).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&");return i({url:"/api/v1/history/search"+(t?"?"+t:""),method:"GET"})},deleteHistory:e=>i({url:"/api/v1/history/delete",method:"DELETE",data:e}),getContents:e=>i({url:"/contents/list",method:"GET",data:e}),searchContents:e=>i({url:"/contents/search",method:"GET",data:e}),generateImage:e=>i({url:"/image/generate",method:"POST",data:e}),batchGenerateImage:e=>i({url:"/image/batch-generate",method:"POST",data:e}),uploadDocument:a=>new Promise(((i,d)=>{const l=t(n.TOKEN_KEY);o({url:s+"/api/v1/rag/upload",filePath:a,name:"file",header:{Authorization:l?`Bearer ${l}`:""},success:t=>{if(200===t.statusCode)try{const e=JSON.parse(t.data);200===e.code?i(e):d(new Error(e.message||e.detail||"上传失败"))}catch(o){d(new Error("响应解析失败"))}else if(401===t.statusCode)e(n.TOKEN_KEY),e(n.USER_INFO_KEY),r({url:"/pages/login/login"}),d(new Error("登录已过期，请重新登录"));else try{const e=JSON.parse(t.data);d(new Error(e.detail||e.message||`上传失败: ${t.statusCode}`))}catch(o){d(new Error(`上传失败: ${t.statusCode}`))}},fail:e=>{d(new Error(e.errMsg||"上传失败"))}})})),deleteDocument:e=>i({url:"/api/v1/rag/delete",method:"DELETE",data:{document_id:e}}),getDocuments:e=>{const t=Object.keys(e||{}).filter((t=>void 0!==e[t]&&null!==e[t])).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&");return i({url:"/api/v1/rag/list"+(t?"?"+t:""),method:"GET"})},searchRAG:e=>i({url:"/api/v1/rag/search",method:"POST",data:e})},l=(e,t)=>{const o=e.__vccOpts||e;for(const[r,a]of t)o[r]=a;return o};export{l as _,d as h};
