import{r as e,c as a,E as l,b as t,w as s,s as n,d as u,o as c,e as o,f as i,h as d,t as r,j as f,k as _,F as v,G as m,m as p,n as h,I as g,A as y}from"./index-DiFUrjbL.js";import{_ as b,h as k}from"./_plugin-vue_export-helper.BWtSqQHM.js";const x=b({__name:"rag",setup(b){const x=e([]),C=e([]),w=e(!1),F=e(!1),D=e(1),M=e(20),B=e(0),N=e(""),z=e(!1),$=a((()=>Math.ceil(B.value/M.value))),j=e=>{const a=Number(e);return Number.isNaN(a)?"-":a.toFixed(3)},V=e=>{if(!e)return"";const a=new Date(e),l=new Date-a;return l<6e4?"åˆšåˆš":l<36e5?`${Math.floor(l/6e4)}åˆ†é’Ÿå‰`:l<864e5?`${Math.floor(l/36e5)}å°æ—¶å‰`:l<6048e5?`${Math.floor(l/864e5)}å¤©å‰`:a.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},A=()=>{m({count:1,extension:[".pdf",".doc",".docx",".txt"],success:e=>{if(e.tempFiles&&e.tempFiles.length>0){const a=e.tempFiles[0];if(a.size>52428800)return void n({title:"æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡50MB",icon:"none"});G(a.path)}},fail:e=>{console.error("é€‰æ‹©æ–‡ä»¶å¤±è´¥:",e),n({title:e.errMsg||"é€‰æ‹©æ–‡ä»¶å¤±è´¥",icon:"none"})}})},G=async e=>{F.value=!0;try{const a=await k.uploadDocument(e);200===a.code?(n({title:"ä¸Šä¼ æˆåŠŸ",icon:"success"}),I(!0)):n({title:a.message||"ä¸Šä¼ å¤±è´¥",icon:"none"})}catch(a){console.error("ä¸Šä¼ æ–‡æ¡£å¤±è´¥:",a),n({title:a.message||"ä¸Šä¼ å¤±è´¥",icon:"none"})}finally{F.value=!1}},I=async(e=!1)=>{e&&(D.value=1),w.value=!0;try{const e=await k.getDocuments({page:D.value,page_size:M.value});200===e.code?(x.value=e.data.items||[],B.value=e.data.total||0):n({title:e.message||"åŠ è½½å¤±è´¥",icon:"none"})}catch(a){console.error("åŠ è½½æ–‡æ¡£åˆ—è¡¨å¤±è´¥:",a),n({title:a.message||"åŠ è½½å¤±è´¥",icon:"none"})}finally{w.value=!1}},q=async()=>{if(N.value.trim()){z.value=!0,w.value=!0;try{const e=await k.searchRAG({query:N.value.trim(),top_k:5});200===e.code?(C.value=e.data.results||[],0===C.value.length&&n({title:"æœªæ‰¾åˆ°ç›¸å…³æ–‡æ¡£",icon:"none"})):n({title:e.message||"æœç´¢å¤±è´¥",icon:"none"})}catch(e){console.error("æœç´¢å¤±è´¥:",e),n({title:e.message||"æœç´¢å¤±è´¥",icon:"none"})}finally{w.value=!1}}else n({title:"è¯·è¾“å…¥æœç´¢å…³é”®è¯",icon:"none"})},E=()=>{z.value=!1,N.value="",C.value=[],I(!0)},K=async e=>{try{const a=await k.deleteDocument(e);200===a.code?(n({title:"åˆ é™¤æˆåŠŸ",icon:"success"}),I(!0)):n({title:a.message||"åˆ é™¤å¤±è´¥",icon:"none"})}catch(a){console.error("åˆ é™¤æ–‡æ¡£å¤±è´¥:",a),n({title:a.message||"åˆ é™¤å¤±è´¥",icon:"none"})}},L=e=>{e<1||e>$.value||(D.value=e,I())};return l((()=>{I()})),(e,a)=>{const l=p,n=u,m=h,b=g;return c(),t(n,{class:"rag-page"},{default:s((()=>[o(n,{class:"header"},{default:s((()=>[o(l,{class:"title"},{default:s((()=>[i("ðŸ“– çŸ¥è¯†åº“")])),_:1})])),_:1}),o(n,{class:"upload-card card"},{default:s((()=>[o(n,{class:"upload-section"},{default:s((()=>[o(m,{class:"btn btn-primary btn-upload",onClick:A},{default:s((()=>[i(" ðŸ“¤ ä¸Šä¼ æ–‡æ¡£ ")])),_:1}),o(l,{class:"upload-tip"},{default:s((()=>[i("æ”¯æŒ PDFã€Wordã€Txt æ ¼å¼")])),_:1})])),_:1}),F.value?(c(),t(n,{key:0,class:"upload-status"},{default:s((()=>[o(l,null,{default:s((()=>[i("ä¸Šä¼ ä¸­...")])),_:1})])),_:1})):d("",!0)])),_:1}),o(n,{class:"search-card card"},{default:s((()=>[o(n,{class:"search-box"},{default:s((()=>[o(b,{class:"search-input",modelValue:N.value,"onUpdate:modelValue":a[0]||(a[0]=e=>N.value=e),placeholder:"è¾“å…¥å…³é”®è¯è¿›è¡Œè¯­ä¹‰æ£€ç´¢...",onConfirm:q},null,8,["modelValue"]),o(m,{class:"btn btn-primary btn-small",onClick:q},{default:s((()=>[i("ðŸ” æœç´¢")])),_:1})])),_:1}),z.value?(c(),t(n,{key:0,class:"search-tip"},{default:s((()=>[o(l,null,{default:s((()=>[i("æœç´¢å…³é”®è¯: "+r(N.value),1)])),_:1}),o(l,{class:"cancel-search",onClick:E},{default:s((()=>[i("å–æ¶ˆæœç´¢")])),_:1})])),_:1})):d("",!0)])),_:1}),z.value&&C.value.length>0?(c(),t(n,{key:0,class:"search-results"},{default:s((()=>[o(n,{class:"section-title"},{default:s((()=>[i("ðŸ” æœç´¢ç»“æžœ ("+r(C.value.length)+" æ¡)",1)])),_:1}),(c(!0),f(v,null,_(C.value,((e,a)=>(c(),t(n,{key:a,class:"search-result-item card"},{default:s((()=>[o(n,{class:"result-header"},{default:s((()=>[o(l,{class:"result-score"},{default:s((()=>[i("è·ç¦»å€¼: "+r(j(e.distance)),1)])),_:2},1024),o(l,{class:"result-file"},{default:s((()=>[i(r(e.metadata.file_name),1)])),_:2},1024)])),_:2},1024),o(n,{class:"result-content"},{default:s((()=>[o(l,{class:"result-text"},{default:s((()=>[i(r(e.content),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):d("",!0),z.value?d("",!0):(c(),t(n,{key:1,class:"documents-section"},{default:s((()=>[o(n,{class:"section-title"},{default:s((()=>[i(" ðŸ“š æˆ‘çš„æ–‡æ¡£ (å…± "+r(B.value)+" ä¸ª) ",1)])),_:1}),w.value?(c(),t(n,{key:0,class:"loading"},{default:s((()=>[o(l,null,{default:s((()=>[i("åŠ è½½ä¸­...")])),_:1})])),_:1})):0===x.value.length?(c(),t(n,{key:1,class:"empty"},{default:s((()=>[o(l,null,{default:s((()=>[i("æš‚æ— æ–‡æ¡£ï¼Œè¯·ä¸Šä¼ æ–‡æ¡£")])),_:1})])),_:1})):(c(),t(n,{key:2},{default:s((()=>[(c(!0),f(v,null,_(x.value,((e,a)=>(c(),t(n,{key:e.document_id,class:"document-item card"},{default:s((()=>[o(n,{class:"doc-header"},{default:s((()=>[o(n,{class:"doc-info"},{default:s((()=>[o(l,{class:"doc-name"},{default:s((()=>[i(r(e.file_name),1)])),_:2},1024),o(l,{class:"doc-meta"},{default:s((()=>{return[i(r((a=e.file_size,a?a<1024?a+" B":a<1048576?(a/1024).toFixed(1)+" KB":(a/1048576).toFixed(1)+" MB":"0 B"))+" Â· "+r(e.chunks_count)+" å— Â· "+r(V(e.uploaded_at)),1)];var a})),_:2},1024)])),_:2},1024),o(m,{class:"btn-delete",onClick:a=>{return l=e.document_id,t=e.file_name,void y({title:"ç¡®è®¤åˆ é™¤",content:`ç¡®å®šè¦åˆ é™¤æ–‡æ¡£ "${t}" å—ï¼Ÿ`,success:async e=>{e.confirm&&await K(l)}});var l,t}},{default:s((()=>[i(" ðŸ—‘ï¸ ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1}))])),_:1})),!z.value&&B.value>0?(c(),t(n,{key:2,class:"pagination"},{default:s((()=>[o(m,{class:"btn btn-outline btn-small",disabled:1===D.value,onClick:a[1]||(a[1]=e=>L(D.value-1))},{default:s((()=>[i("ä¸Šä¸€é¡µ")])),_:1},8,["disabled"]),o(l,{class:"page-info"},{default:s((()=>[i("ç¬¬ "+r(D.value)+" / "+r($.value)+" é¡µ (å…± "+r(B.value)+" ä¸ª)",1)])),_:1}),o(m,{class:"btn btn-outline btn-small",disabled:D.value>=$.value,onClick:a[2]||(a[2]=e=>L(D.value+1))},{default:s((()=>[i("ä¸‹ä¸€é¡µ")])),_:1},8,["disabled"])])),_:1})):d("",!0)])),_:1})}}},[["__scopeId","data-v-1b316c66"]]);export{x as default};
