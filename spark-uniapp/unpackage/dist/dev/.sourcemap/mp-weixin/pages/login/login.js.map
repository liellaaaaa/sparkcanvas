{"version":3,"file":"login.js","sources":["pages/login/login.vue","../../../CodeSoftware/uniapp/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\r\n  <view class=\"login-page\">\r\n    <view class=\"header\">\r\n      <text class=\"title\">欢迎使用 SparkCanvas</text>\r\n      <text class=\"subtitle\">AI内容创作平台</text>\r\n    </view>\r\n    \r\n    <view class=\"login-card card\">\r\n      <view class=\"input-group\">\r\n        <text class=\"label\">邮箱</text>\r\n        <input\r\n          v-model=\"formData.email\"\r\n          class=\"input\"\r\n          placeholder=\"请输入邮箱\"\r\n          placeholder-class=\"placeholder\"\r\n          type=\"text\"\r\n        />\r\n      </view>\r\n      \r\n      <view class=\"input-group\">\r\n        <text class=\"label\">密码</text>\r\n        <input\r\n          v-model=\"formData.password\"\r\n          class=\"input\"\r\n          placeholder=\"请输入密码\"\r\n          placeholder-class=\"placeholder\"\r\n          type=\"password\"\r\n        />\r\n      </view>\r\n      \r\n      <button class=\"btn login-btn\" @click=\"handleLogin\" :loading=\"loading\">\r\n        {{ loading ? '登录中...' : '登录' }}\r\n      </button>\r\n      \r\n      <view class=\"footer-links\">\r\n        <text class=\"link\" @click=\"goToRegister\">还没有账号？立即注册</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive } from 'vue'\r\nimport http from '@/utils/http.js'\r\nimport storage from '@/utils/storage.js'\r\n\r\nconst formData = reactive({\r\n  email: '',\r\n  password: ''\r\n})\r\n\r\nconst loading = ref(false)\r\n\r\n// 邮箱格式验证\r\nconst validateEmail = (email) => {\r\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\r\n  return emailRegex.test(email)\r\n}\r\n\r\nconst handleLogin = async () => {\r\n  // 表单验证\r\n  if (!formData.email.trim()) {\r\n    uni.showToast({ title: '请输入邮箱', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  if (!validateEmail(formData.email)) {\r\n    uni.showToast({ title: '请输入正确的邮箱格式', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  if (!formData.password.trim()) {\r\n    uni.showToast({ title: '请输入密码', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  if (formData.password.length < 6) {\r\n    uni.showToast({ title: '密码长度至少6位', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  loading.value = true\r\n  uni.showLoading({ title: '登录中...' })\r\n  \r\n  try {\r\n    // 先测试连接（可选，用于调试）\r\n    // try {\r\n    //   await http.testConnection()\r\n    //   console.log('后端连接正常')\r\n    // } catch (e) {\r\n    //   console.warn('后端连接测试失败:', e)\r\n    // }\r\n    \r\n    // 调用登录API\r\n    const result = await http.login({\r\n      email: formData.email.trim(),\r\n      password: formData.password\r\n    })\r\n    \r\n    // 存储Token和用户信息\r\n    storage.setToken(result.token)\r\n    storage.setUserInfo(result.user)\r\n    \r\n    uni.showToast({ title: '登录成功', icon: 'success' })\r\n    \r\n    // 延迟跳转，让用户看到成功提示\r\n    setTimeout(() => {\r\n      uni.switchTab({\r\n        url: '/pages/workspace/workspace'\r\n      })\r\n    }, 1500)\r\n  } catch (e) {\r\n    console.error('登录失败:', e)\r\n    let errorMessage = e.message || '登录失败，请检查邮箱和密码'\r\n    \r\n    // 如果是超时或连接错误，提供更详细的提示\r\n    if (errorMessage.includes('超时') || errorMessage.includes('连接')) {\r\n      // 显示模态框，提供更详细的错误信息\r\n      uni.showModal({\r\n        title: '连接失败',\r\n        content: errorMessage + '\\n\\n请检查：\\n1. 后端服务是否已启动（运行 python spark-backend/main.py）\\n2. 访问 http://localhost:8000/health 测试后端是否正常\\n3. 检查后端日志是否有错误信息',\r\n        showCancel: false,\r\n        confirmText: '我知道了'\r\n      })\r\n    } else {\r\n      uni.showToast({\r\n        title: errorMessage,\r\n        icon: 'none',\r\n        duration: 3000\r\n      })\r\n    }\r\n  } finally {\r\n    loading.value = false\r\n    uni.hideLoading()\r\n  }\r\n}\r\n\r\nconst goToRegister = () => {\r\n  uni.navigateTo({\r\n    url: '/pages/register/register'\r\n  })\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.login-page {\r\n  min-height: 100vh;\r\n  padding: 40rpx 30rpx;\r\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n}\r\n\r\n.header {\r\n  text-align: center;\r\n  margin-bottom: 60rpx;\r\n  padding-top: 80rpx;\r\n}\r\n\r\n.title {\r\n  font-size: 48rpx;\r\n  font-weight: 700;\r\n  color: #ffffff;\r\n  display: block;\r\n  margin-bottom: 12rpx;\r\n}\r\n\r\n.subtitle {\r\n  font-size: 28rpx;\r\n  color: rgba(255, 255, 255, 0.8);\r\n}\r\n\r\n.card {\r\n  background: #ffffff;\r\n  border-radius: 24rpx;\r\n  box-shadow: 0 8rpx 30rpx rgba(0, 0, 0, 0.2);\r\n  padding: 50rpx 40rpx;\r\n}\r\n\r\n.input-group {\r\n  margin-bottom: 40rpx;\r\n}\r\n\r\n.label {\r\n  display: block;\r\n  font-size: 30rpx;\r\n  color: #333;\r\n  margin-bottom: 16rpx;\r\n  font-weight: 500;\r\n}\r\n\r\n.input {\r\n  width: 100%;\r\n  height: 88rpx;\r\n  padding: 0 28rpx;\r\n  border-radius: 16rpx;\r\n  background: #f8f8f8;\r\n  border: 2rpx solid #e0e0e0;\r\n  font-size: 30rpx;\r\n  color: #333;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.input:focus {\r\n  border-color: #3c9cff;\r\n  background: #f0f7ff;\r\n}\r\n\r\n.placeholder {\r\n  color: #aaa;\r\n}\r\n\r\n.login-btn {\r\n  width: 100%;\r\n  height: 88rpx;\r\n  line-height: 88rpx;\r\n  font-size: 32rpx;\r\n  font-weight: 600;\r\n  border-radius: 50rpx;\r\n  color: #fff;\r\n  background: linear-gradient(135deg, #3c9cff, #2b7ce9);\r\n  border: none;\r\n  box-shadow: 0 6rpx 20rpx rgba(60, 156, 255, 0.3);\r\n  margin-top: 20rpx;\r\n}\r\n\r\n.login-btn:active {\r\n  transform: scale(0.98);\r\n}\r\n\r\n.footer-links {\r\n  text-align: center;\r\n  margin-top: 40rpx;\r\n}\r\n\r\n.link {\r\n  font-size: 28rpx;\r\n  color: #3c9cff;\r\n}\r\n</style>\r\n\r\n","import MiniProgramPage from 'D:/Deployment/sparkcanvas/spark-uniapp/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["reactive","ref","uni","http","storage"],"mappings":";;;;;;;AA8CA,UAAM,WAAWA,cAAAA,SAAS;AAAA,MACxB,OAAO;AAAA,MACP,UAAU;AAAA,IACZ,CAAC;AAED,UAAM,UAAUC,cAAG,IAAC,KAAK;AAGzB,UAAM,gBAAgB,CAAC,UAAU;AAC/B,YAAM,aAAa;AACnB,aAAO,WAAW,KAAK,KAAK;AAAA,IAC9B;AAEA,UAAM,cAAc,YAAY;AAE9B,UAAI,CAAC,SAAS,MAAM,QAAQ;AAC1BC,sBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,QAAQ;AAC9C;AAAA,MACD;AAED,UAAI,CAAC,cAAc,SAAS,KAAK,GAAG;AAClCA,sBAAG,MAAC,UAAU,EAAE,OAAO,cAAc,MAAM,QAAQ;AACnD;AAAA,MACD;AAED,UAAI,CAAC,SAAS,SAAS,QAAQ;AAC7BA,sBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,QAAQ;AAC9C;AAAA,MACD;AAED,UAAI,SAAS,SAAS,SAAS,GAAG;AAChCA,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,QAAQ;AACjD;AAAA,MACD;AAED,cAAQ,QAAQ;AAChBA,oBAAAA,MAAI,YAAY,EAAE,OAAO,SAAQ,CAAE;AAEnC,UAAI;AAUF,cAAM,SAAS,MAAMC,WAAI,KAAC,MAAM;AAAA,UAC9B,OAAO,SAAS,MAAM,KAAM;AAAA,UAC5B,UAAU,SAAS;AAAA,QACzB,CAAK;AAGDC,8BAAQ,SAAS,OAAO,KAAK;AAC7BA,8BAAQ,YAAY,OAAO,IAAI;AAE/BF,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,WAAW;AAGhD,mBAAW,MAAM;AACfA,wBAAAA,MAAI,UAAU;AAAA,YACZ,KAAK;AAAA,UACb,CAAO;AAAA,QACF,GAAE,IAAI;AAAA,MACR,SAAQ,GAAG;AACVA,sBAAAA,MAAA,MAAA,SAAA,gCAAc,SAAS,CAAC;AACxB,YAAI,eAAe,EAAE,WAAW;AAGhC,YAAI,aAAa,SAAS,IAAI,KAAK,aAAa,SAAS,IAAI,GAAG;AAE9DA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,SAAS,eAAe;AAAA,YACxB,YAAY;AAAA,YACZ,aAAa;AAAA,UACrB,CAAO;AAAA,QACP,OAAW;AACLA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,YACN,UAAU;AAAA,UAClB,CAAO;AAAA,QACF;AAAA,MACL,UAAY;AACR,gBAAQ,QAAQ;AAChBA,sBAAAA,MAAI,YAAa;AAAA,MAClB;AAAA,IACH;AAEA,UAAM,eAAe,MAAM;AACzBA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACT,CAAG;AAAA,IACH;;;;;;;;;;;;;;;;AC5IA,GAAG,WAAW,eAAe;"}