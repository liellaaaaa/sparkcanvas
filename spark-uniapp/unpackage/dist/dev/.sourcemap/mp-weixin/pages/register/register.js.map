{"version":3,"file":"register.js","sources":["pages/register/register.vue","../../../CodeSoftware/uniapp/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcmVnaXN0ZXIvcmVnaXN0ZXIudnVl"],"sourcesContent":["<template>\r\n  <view class=\"register-page\">\r\n    <view class=\"header\">\r\n      <text class=\"title\">注册 SparkCanvas</text>\r\n      <text class=\"subtitle\">开启AI创作之旅</text>\r\n    </view>\r\n    \r\n    <view class=\"register-card card\">\r\n      <view class=\"input-group\">\r\n        <text class=\"label\">用户名</text>\r\n        <input\r\n          v-model=\"formData.username\"\r\n          class=\"input\"\r\n          placeholder=\"请输入用户名\"\r\n          placeholder-class=\"placeholder\"\r\n          type=\"text\"\r\n        />\r\n      </view>\r\n      \r\n      <view class=\"input-group\">\r\n        <text class=\"label\">邮箱</text>\r\n        <input\r\n          v-model=\"formData.email\"\r\n          class=\"input\"\r\n          placeholder=\"请输入邮箱\"\r\n          placeholder-class=\"placeholder\"\r\n          type=\"text\"\r\n        />\r\n      </view>\r\n      \r\n      <view class=\"input-group\">\r\n        <text class=\"label\">验证码</text>\r\n        <view class=\"code-row\">\r\n          <input\r\n            v-model=\"formData.verifyCode\"\r\n            class=\"input code-input\"\r\n            placeholder=\"请输入验证码\"\r\n            placeholder-class=\"placeholder\"\r\n            type=\"text\"\r\n          />\r\n          <button class=\"code-btn\" @click=\"sendCode\" :disabled=\"codeCountdown > 0\">\r\n            {{ codeCountdown > 0 ? `${codeCountdown}s` : '发送验证码' }}\r\n          </button>\r\n        </view>\r\n      </view>\r\n      \r\n      <view class=\"input-group\">\r\n        <text class=\"label\">密码</text>\r\n        <input\r\n          v-model=\"formData.password\"\r\n          class=\"input\"\r\n          placeholder=\"请输入密码（6-20位）\"\r\n          placeholder-class=\"placeholder\"\r\n          type=\"password\"\r\n        />\r\n      </view>\r\n      \r\n      <view class=\"input-group\">\r\n        <text class=\"label\">确认密码</text>\r\n        <input\r\n          v-model=\"formData.confirmPassword\"\r\n          class=\"input\"\r\n          placeholder=\"请再次输入密码\"\r\n          placeholder-class=\"placeholder\"\r\n          type=\"password\"\r\n        />\r\n      </view>\r\n      \r\n      <button class=\"btn register-btn\" @click=\"handleRegister\" :loading=\"loading\">\r\n        {{ loading ? '注册中...' : '注册' }}\r\n      </button>\r\n      \r\n      <view class=\"footer-links\">\r\n        <text class=\"link\" @click=\"goToLogin\">已有账号？立即登录</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, onUnmounted } from 'vue'\r\nimport http from '@/utils/http.js'\r\nimport storage from '@/utils/storage.js'\r\n\r\nconst formData = reactive({\r\n  username: '',\r\n  email: '',\r\n  verifyCode: '',\r\n  password: '',\r\n  confirmPassword: ''\r\n})\r\n\r\nconst loading = ref(false)\r\nconst codeCountdown = ref(0)\r\nlet countdownTimer = null\r\n\r\n// 邮箱格式验证\r\nconst validateEmail = (email) => {\r\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\r\n  return emailRegex.test(email)\r\n}\r\n\r\n// 发送验证码\r\nconst sendCode = async () => {\r\n  if (!formData.email.trim()) {\r\n    uni.showToast({ title: '请先输入邮箱', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  if (!validateEmail(formData.email)) {\r\n    uni.showToast({ title: '请输入正确的邮箱格式', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  // 如果正在倒计时，不允许重复发送\r\n  if (codeCountdown.value > 0) {\r\n    return\r\n  }\r\n  \r\n  try {\r\n    uni.showLoading({ title: '发送中...' })\r\n    \r\n    // 调用发送验证码API\r\n    await http.sendCode(formData.email.trim())\r\n    \r\n    uni.showToast({ title: '验证码已发送，请查收邮箱', icon: 'success', duration: 2000 })\r\n    \r\n    // 开始倒计时\r\n    codeCountdown.value = 60\r\n    if (countdownTimer) {\r\n      clearInterval(countdownTimer)\r\n    }\r\n    countdownTimer = setInterval(() => {\r\n      codeCountdown.value--\r\n      if (codeCountdown.value <= 0) {\r\n        clearInterval(countdownTimer)\r\n        countdownTimer = null\r\n      }\r\n    }, 1000)\r\n  } catch (e) {\r\n    console.error('发送验证码失败:', e)\r\n    uni.showToast({\r\n      title: e.message || '验证码发送失败，请稍后重试',\r\n      icon: 'none',\r\n      duration: 2000\r\n    })\r\n  } finally {\r\n    uni.hideLoading()\r\n  }\r\n}\r\n\r\n// 用户注册\r\nconst handleRegister = async () => {\r\n  // 表单验证\r\n  if (!formData.username.trim()) {\r\n    uni.showToast({ title: '请输入用户名', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  if (formData.username.trim().length < 3 || formData.username.trim().length > 20) {\r\n    uni.showToast({ title: '用户名长度为3-20个字符', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  if (!formData.email.trim()) {\r\n    uni.showToast({ title: '请输入邮箱', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  if (!validateEmail(formData.email)) {\r\n    uni.showToast({ title: '请输入正确的邮箱格式', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  if (!formData.verifyCode.trim()) {\r\n    uni.showToast({ title: '请输入验证码', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  if (formData.verifyCode.trim().length !== 4) {\r\n    uni.showToast({ title: '验证码为4位数字', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  if (!formData.password.trim()) {\r\n    uni.showToast({ title: '请输入密码', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  if (formData.password.length < 6 || formData.password.length > 20) {\r\n    uni.showToast({ title: '密码长度为6-20个字符', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  if (!formData.confirmPassword.trim()) {\r\n    uni.showToast({ title: '请确认密码', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  if (formData.password !== formData.confirmPassword) {\r\n    uni.showToast({ title: '两次输入的密码不一致', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  loading.value = true\r\n  uni.showLoading({ title: '注册中...' })\r\n  \r\n  try {\r\n    // 调用注册API\r\n    await http.register({\r\n      username: formData.username.trim(),\r\n      email: formData.email.trim(),\r\n      password: formData.password,\r\n      confirm_password: formData.confirmPassword,\r\n      code: formData.verifyCode.trim()\r\n    })\r\n    \r\n    uni.showToast({ title: '注册成功', icon: 'success' })\r\n    \r\n    // 注册成功后，自动登录\r\n    setTimeout(async () => {\r\n      try {\r\n        const loginResult = await http.login({\r\n          email: formData.email.trim(),\r\n          password: formData.password\r\n        })\r\n        \r\n        // 存储Token和用户信息\r\n        storage.setToken(loginResult.token)\r\n        storage.setUserInfo(loginResult.user)\r\n        \r\n        // 跳转到工作台\r\n        uni.switchTab({\r\n          url: '/pages/workspace/workspace'\r\n        })\r\n      } catch (e) {\r\n        // 自动登录失败，跳转到登录页\r\n        console.error('自动登录失败:', e)\r\n        uni.showToast({\r\n          title: '注册成功，请登录',\r\n          icon: 'success'\r\n        })\r\n        setTimeout(() => {\r\n          uni.navigateTo({\r\n            url: '/pages/login/login'\r\n          })\r\n        }, 1500)\r\n      }\r\n    }, 1500)\r\n  } catch (e) {\r\n    console.error('注册失败:', e)\r\n    uni.showToast({\r\n      title: e.message || '注册失败，请检查信息后重试',\r\n      icon: 'none',\r\n      duration: 2000\r\n    })\r\n  } finally {\r\n    loading.value = false\r\n    uni.hideLoading()\r\n  }\r\n}\r\n\r\nconst goToLogin = () => {\r\n  uni.navigateTo({\r\n    url: '/pages/login/login'\r\n  })\r\n}\r\n\r\n// 组件卸载时清除定时器\r\nonUnmounted(() => {\r\n  if (countdownTimer) {\r\n    clearInterval(countdownTimer)\r\n    countdownTimer = null\r\n  }\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.register-page {\r\n  min-height: 100vh;\r\n  padding: 40rpx 30rpx;\r\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n}\r\n\r\n.header {\r\n  text-align: center;\r\n  margin-bottom: 60rpx;\r\n  padding-top: 80rpx;\r\n}\r\n\r\n.title {\r\n  font-size: 48rpx;\r\n  font-weight: 700;\r\n  color: #ffffff;\r\n  display: block;\r\n  margin-bottom: 12rpx;\r\n}\r\n\r\n.subtitle {\r\n  font-size: 28rpx;\r\n  color: rgba(255, 255, 255, 0.8);\r\n}\r\n\r\n.card {\r\n  background: #ffffff;\r\n  border-radius: 24rpx;\r\n  box-shadow: 0 8rpx 30rpx rgba(0, 0, 0, 0.2);\r\n  padding: 50rpx 40rpx;\r\n}\r\n\r\n.input-group {\r\n  margin-bottom: 40rpx;\r\n}\r\n\r\n.label {\r\n  display: block;\r\n  font-size: 30rpx;\r\n  color: #333;\r\n  margin-bottom: 16rpx;\r\n  font-weight: 500;\r\n}\r\n\r\n.input {\r\n  width: 100%;\r\n  height: 88rpx;\r\n  padding: 0 28rpx;\r\n  border-radius: 16rpx;\r\n  background: #f8f8f8;\r\n  border: 2rpx solid #e0e0e0;\r\n  font-size: 30rpx;\r\n  color: #333;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.input:focus {\r\n  border-color: #3c9cff;\r\n  background: #f0f7ff;\r\n}\r\n\r\n.placeholder {\r\n  color: #aaa;\r\n}\r\n\r\n.code-row {\r\n  display: flex;\r\n  gap: 20rpx;\r\n}\r\n\r\n.code-input {\r\n  flex: 1;\r\n}\r\n\r\n.code-btn {\r\n  width: 200rpx;\r\n  height: 88rpx;\r\n  line-height: 88rpx;\r\n  font-size: 26rpx;\r\n  color: #3c9cff;\r\n  background: #f0f7ff;\r\n  border: 2rpx solid #3c9cff;\r\n  border-radius: 16rpx;\r\n  padding: 0;\r\n}\r\n\r\n.code-btn[disabled] {\r\n  opacity: 0.6;\r\n  color: #999;\r\n  border-color: #ccc;\r\n}\r\n\r\n.register-btn {\r\n  width: 100%;\r\n  height: 88rpx;\r\n  line-height: 88rpx;\r\n  font-size: 32rpx;\r\n  font-weight: 600;\r\n  border-radius: 50rpx;\r\n  color: #fff;\r\n  background: linear-gradient(135deg, #3c9cff, #2b7ce9);\r\n  border: none;\r\n  box-shadow: 0 6rpx 20rpx rgba(60, 156, 255, 0.3);\r\n  margin-top: 20rpx;\r\n}\r\n\r\n.register-btn:active {\r\n  transform: scale(0.98);\r\n}\r\n\r\n.footer-links {\r\n  text-align: center;\r\n  margin-top: 40rpx;\r\n}\r\n\r\n.link {\r\n  font-size: 28rpx;\r\n  color: #3c9cff;\r\n}\r\n</style>\r\n\r\n","import MiniProgramPage from 'D:/Deployment/sparkcanvas/spark-uniapp/pages/register/register.vue'\nwx.createPage(MiniProgramPage)"],"names":["reactive","ref","uni","http","storage","onUnmounted"],"mappings":"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"}