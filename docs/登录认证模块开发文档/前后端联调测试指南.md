# 前后端联调测试指南

## 🎯 测试目标

验证前端登录注册功能与后端API的完整联调。

## 📋 前置准备

### 1. 启动后端服务

```bash
cd spark-backend
python main.py
```

后端服务应运行在 `http://localhost:8000`

### 2. 配置前端API地址

编辑 `utils/config.js`：

```javascript
const config = {
  BASE_URL: 'http://localhost:8000',  // 确保与后端地址一致
  // ...
}
```

### 3. 检查数据库

确保数据库已初始化，包含 `user` 和 `email_code` 表。

```bash
cd spark-backend
python init_db.py
```

### 4. 检查邮件配置

确保后端邮件服务配置正确（`config/config.yaml` 或 `.env`）。

## 🧪 测试用例

### 测试用例 1: 发送验证码

**步骤**:
1. 打开注册页面
2. 输入邮箱（例如: `test@example.com`）
3. 点击"发送验证码"按钮

**预期结果**:
- ✅ 按钮显示倒计时（60秒）
- ✅ 提示"验证码已发送，请查收邮箱"
- ✅ 邮箱收到验证码邮件（4位数字）
- ✅ 倒计时期间按钮禁用

**验证点**:
- [ ] 邮箱格式验证
- [ ] 倒计时功能
- [ ] 邮件发送成功
- [ ] 错误提示（如果邮箱格式错误）

### 测试用例 2: 用户注册

**步骤**:
1. 完成测试用例 1（获取验证码）
2. 输入用户名（3-20字符，例如: `testuser`）
3. 输入验证码（从邮箱获取）
4. 输入密码（6-20字符，例如: `password123`）
5. 输入确认密码（与密码一致）
6. 点击"注册"按钮

**预期结果**:
- ✅ 提示"注册成功"
- ✅ 自动登录
- ✅ 跳转到工作台页面
- ✅ Token和用户信息已存储

**验证点**:
- [ ] 用户名长度验证（3-20字符）
- [ ] 邮箱格式验证
- [ ] 验证码格式验证（4位数字）
- [ ] 密码长度验证（6-20字符）
- [ ] 密码一致性验证
- [ ] 注册成功
- [ ] 自动登录
- [ ] Token存储

**异常情况测试**:
- [ ] 邮箱已存在（应提示"该邮箱已经存在！"）
- [ ] 验证码错误（应提示"邮箱或验证码错误！"）
- [ ] 验证码过期（应提示错误）
- [ ] 密码不一致（应提示"两个密码不一致！"）

### 测试用例 3: 用户登录

**步骤**:
1. 打开登录页面
2. 输入已注册的邮箱
3. 输入对应的密码
4. 点击"登录"按钮

**预期结果**:
- ✅ 提示"登录成功"
- ✅ 跳转到工作台页面
- ✅ Token和用户信息已存储

**验证点**:
- [ ] 邮箱格式验证
- [ ] 密码验证
- [ ] 登录成功
- [ ] Token存储
- [ ] 用户信息存储
- [ ] 页面跳转

**异常情况测试**:
- [ ] 用户不存在（应提示"该用户不存在！"）
- [ ] 密码错误（应提示"邮箱或密码错误！"）
- [ ] 邮箱格式错误（应提示"请输入正确的邮箱格式"）

### 测试用例 4: Token 管理

**步骤**:
1. 完成登录
2. 检查本地存储
3. 查看请求头

**预期结果**:
- ✅ `access_token` 已存储
- ✅ `user_info` 已存储
- ✅ 后续请求自动携带 `Authorization: Bearer {token}` 头

**验证点**:
- [ ] Token存储位置正确
- [ ] 用户信息存储正确
- [ ] 请求头包含Token

### 测试用例 5: 页面跳转

**步骤**:
1. 从登录页点击"还没有账号？立即注册"
2. 从注册页点击"已有账号？立即登录"

**预期结果**:
- ✅ 页面跳转正常
- ✅ 表单数据不丢失（可选）

**验证点**:
- [ ] 登录页 → 注册页
- [ ] 注册页 → 登录页

## 🔍 调试方法

### 1. 查看网络请求

在浏览器开发者工具中：
1. 打开 Network 标签
2. 执行操作（登录/注册）
3. 查看请求详情：
   - 请求URL
   - 请求方法
   - 请求头
   - 请求体
   - 响应状态码
   - 响应体

### 2. 查看控制台日志

前端代码中的 `console.log` 和 `console.error` 会输出到控制台。

### 3. 查看后端日志

后端服务会输出详细的日志，包括：
- 请求信息
- 数据库操作
- 错误信息

### 4. 检查本地存储

在浏览器开发者工具中：
1. 打开 Application 标签
2. 查看 Local Storage
3. 检查 `access_token` 和 `user_info`

## 🐛 常见问题排查

### 问题 1: 网络请求失败

**症状**: 提示"网络请求失败，请检查网络连接"

**排查步骤**:
1. 检查后端服务是否运行
2. 检查 `utils/config.js` 中的 `BASE_URL`
3. 检查浏览器控制台的网络请求
4. 检查后端日志

**解决方案**:
- 确保后端服务运行在 `http://localhost:8000`
- 确保前端配置的 `BASE_URL` 正确
- 检查防火墙设置

### 问题 2: CORS 错误

**症状**: 浏览器控制台显示 CORS 相关错误

**排查步骤**:
1. 检查后端 CORS 配置
2. 检查请求头

**解决方案**:
- 确保后端 `main.py` 中 CORS 配置正确
- 开发环境可以设置 `allow_origins=["*"]`

### 问题 3: 验证码发送失败

**症状**: 点击发送验证码后提示失败

**排查步骤**:
1. 检查邮箱格式
2. 检查后端邮件配置
3. 查看后端日志

**解决方案**:
- 确保邮箱格式正确
- 检查 `config/config.yaml` 中的邮件配置
- 检查邮件服务是否可用

### 问题 4: 注册/登录失败

**症状**: 提示"注册失败"或"登录失败"

**排查步骤**:
1. 查看错误提示信息
2. 检查请求参数
3. 查看后端日志
4. 检查数据库

**解决方案**:
- 根据错误提示信息调整输入
- 检查后端API响应
- 检查数据库连接

### 问题 5: Token 存储失败

**症状**: 登录后 Token 未存储

**排查步骤**:
1. 检查浏览器本地存储权限
2. 查看控制台错误
3. 检查 `storage.js` 代码

**解决方案**:
- 确保浏览器允许本地存储
- 检查代码逻辑

## ✅ 测试检查清单

### 功能测试

- [ ] 发送验证码功能正常
- [ ] 验证码倒计时正常
- [ ] 注册功能正常
- [ ] 登录功能正常
- [ ] 表单验证正常
- [ ] 错误提示正常
- [ ] 页面跳转正常

### 数据测试

- [ ] Token 存储正常
- [ ] 用户信息存储正常
- [ ] 请求头包含 Token
- [ ] 数据格式正确

### 异常测试

- [ ] 邮箱格式错误处理
- [ ] 密码长度错误处理
- [ ] 验证码错误处理
- [ ] 用户不存在处理
- [ ] 密码错误处理
- [ ] 网络错误处理

### 兼容性测试

- [ ] 不同浏览器测试
- [ ] 移动端测试（如适用）
- [ ] 不同屏幕尺寸测试

## 📊 测试报告模板

```
测试日期: YYYY-MM-DD
测试人员: XXX
测试环境: 开发环境

测试结果:
- 发送验证码: ✅/❌
- 用户注册: ✅/❌
- 用户登录: ✅/❌
- Token管理: ✅/❌
- 页面跳转: ✅/❌

发现的问题:
1. [问题描述]
2. [问题描述]

建议:
1. [建议内容]
2. [建议内容]
```

## 🎉 测试通过标准

所有测试用例通过，且满足以下条件：

1. ✅ 所有功能测试用例通过
2. ✅ 所有异常情况测试通过
3. ✅ 数据存储正常
4. ✅ 页面跳转正常
5. ✅ 用户体验良好
6. ✅ 无严重错误

## 📞 技术支持

如遇到问题，请：
1. 查看本文档的"常见问题排查"部分
2. 查看后端API文档：http://localhost:8000/docs
3. 检查后端日志
4. 检查前端控制台

